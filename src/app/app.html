<!-- Main Content Area: Show different states based on conditions -->
<div class="main-content">
  <!-- Search Screen: Show when searching for connection -->
  <app-search-container *ngIf="isSearchingConnection && isLoggedIn && hasPreferences()"></app-search-container>

  <!-- Chat Interface: Show when connected -->
  <app-chat-container
    *ngIf="!isSearchingConnection && shouldShowChat()"
    [connectedUser]="connectedUser"
    [messages]="messages"
    [newMessage]="newMessage"
    (endChat)="onEndChat()"
    (sendMessage)="onSendMessage($event)"
    (messageChange)="onMessageChange($event)">
  </app-chat-container>

  <!-- Intermediate State: Login or Preferences (only show if not searching and not showing chat) -->
  <div *ngIf="!isSearchingConnection && !shouldShowChat()" class="intermediate-state">
    <div *ngIf="!isLoggedIn; else preferencesComponent">
      <app-login></app-login>
    </div>
    <ng-template #preferencesComponent>
      <app-connection-preferences></app-connection-preferences>
    </ng-template>
  </div>
</div>

<!-- End Chat Confirmation Modal -->
<app-end-chat-modal
  [isVisible]="showEndChatDialog"
  (cancel)="cancelEndChat()"
  (confirm)="confirmEndChat()">
</app-end-chat-modal>

<!-- Chat Ended Notification Modal -->
<app-chat-ended-modal
  [isVisible]="showChatEndedDialog"
  (confirm)="proceedToConnectAgain()">
</app-chat-ended-modal>
