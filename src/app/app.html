<!-- Main Content Area: Show different states based on conditions -->
<div class="main-content">
<!-- Search Screen: Show when searching for connection -->
<app-search-container *ngIf="isSearchingConnection && isLoggedIn && hasPreferences() && !(partner$ | async)"></app-search-container>

<!-- Chat Interface: Show when connected -->
<app-chat-container
  *ngIf="!isSearchingConnection && shouldShowChat() && (partner$ | async)"
  [connectedUser]="(partner$ | async)?.user || {}"
  [messages]="(messages$ | async) || []"
  (endChat)="onEndChat()"
  (sendMessage)="onSendMessage($event)">
</app-chat-container>

  <!-- Intermediate State: Login or Preferences (only show if not searching and not showing chat) -->
  <div *ngIf="!isSearchingConnection && !shouldShowChat()" class="intermediate-state">
    <div *ngIf="!isLoggedIn; else preferencesComponent">
      <app-login></app-login>
    </div>
    <ng-template #preferencesComponent>
      <app-connection-preferences></app-connection-preferences>
    </ng-template>
  </div>
</div>

<!-- End Chat Confirmation Modal -->
<app-end-chat-modal
  [isVisible]="showEndChatDialog"
  (cancel)="cancelEndChat()"
  (confirm)="confirmEndChat()">
</app-end-chat-modal>

<!-- Chat Ended Notification Modal -->
<app-chat-ended-modal
  [isVisible]="showChatEndedDialog"
  (confirm)="proceedToConnectAgain()">
</app-chat-ended-modal>
